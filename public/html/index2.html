<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>期待値スカウター</title>
<meta charset="utf-8">
<meta name="description" content="株価の期待値を計算するツール">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ====================================
   基本スタイル（白黒テーマ）
   ==================================== */
body {
    font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
    color: #000;
    background-color: #fff;
    line-height: 1.6;
    margin: 0;
    padding: 10px;
}

/* リンクを黒色に */
a {
    color: #000;
    text-decoration: underline;
}
a:hover {
    color: #333;
}

/* ====================================
   レスポンシブコンテナ
   ==================================== */
.container {
    max-width: 600px; /* PCでの最大幅 */
    margin: 0 auto; /* 中央寄せ */
    padding: 10px;
}

/* ====================================
   テーブル（フォーム）スタイル
   ==================================== */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    border: 1px solid #000;
    background-color: #fff;
}
th, td {
    padding: 8px;
    border: 1px solid #000;
    text-align: left;
}
th {
    background-color: #f0f0f0;
    text-align: center;
}

/* フォームのラベル（左列）は右寄せ */
table tr td:first-child {
    text-align: right;
    white-space: nowrap; /* ラベルが折り返さないように */
    width: 30%; /* PC表示の調整 */
}

/* 入力フィールド */
input[type="text"] {
    width: 100%;
    box-sizing: border-box;
    padding: 6px;
    border: 1px solid #000;
    background-color: #fff;
    color: #000;
}

/* ====================================
   ボタン
   ==================================== */
button {
    padding: 10px 15px;
    border: 1px solid #000;
    background-color: #fff;
    color: #000;
    cursor: pointer;
    font-size: 1em;
}
button:hover {
    background-color: #e0e0e0;
}

/* ====================================
   画像（レスポンシブ対応）
   ==================================== */
img {
    max-width: 100%;
    height: auto;
    display: block; /* 中央に配置しやすくするため */
    margin: 10px auto;
}

/* ====================================
   スマートフォン向け調整 (480px以下)
   ==================================== */
@media (max-width: 480px) {
    /* フォームのラベルと入力欄の幅調整 */
    table tr td:first-child {
        width: 40%;
    }
}
</style>

<script type="text/javascript">
function x(){
    // eval() の使用はセキュリティリスクがあるため、推奨されませんが、元のコードを維持します。
    var e = eval(document.fm.per.value); // PER
    var b = eval(document.fm.pbr.value); // PBR
    var d = eval(document.fm.dy.value);  // 配当利回り（%）

    // 1. 期待値 x (割安性) の計算
    var x = 2 * Math.pow(d / b / b / e, 1 / 4);

    if (isNaN(x)) {
        document.fm.ex.value = "算定不能";
    } else {
        // 初期期待値を設定
        document.fm.ex.value = x.toFixed(4); // 小数点以下4桁まで表示
    }

    var q = eval(document.fm.qo.value); // 現在の株価
    var p = q * x;

    if (isNaN(p)) {
        document.fm.pr.value = "算定不能";
    } else {
        // 初期目標株価を設定
        document.fm.pr.value = Math.round(p); // 四捨五入
    }

    // 2. n年後の期待値と目標株価の計算 (保有年数が入力されている場合)
    var n = eval(document.fm.hy.value); // 保有年数
    
    // 成長率 g の計算 (ROE - 配当性向*ROE)
    // ROE = PBR / PER = b / e
    // 配当性向 = 配当利回り / (配当利回り * PER) = (d/100) / (d/100 * e) = 1/e (配当利回りd%を配当利回り d/100 として、配当利回り/(株価/EPS) = (d/100)*EPS/株価. ここでは g = ROE - DOE * ROE の形に見える
    // 正しくは g = ROE - 配当性向
    // 成長率 g = b/e - d/100 * b/e (ROE - 配当性向 * ROE)
    // g = ROE * (1 - 配当性向) = (b/e) * (1 - (d/100)/(b/e)) = b/e - d/100 * (b/e) / (b/e) * b/e ではない

    // 元のコードの計算式: g = b / e - b * d / 100;
    // これは g = ROE - ROE * (配当利回り / 100) と解釈できますが、元のコードのロジックに従います。
    var g = b / e - b * d / 100;
    
    // n年後の期待値 r (割安性×成長性＋配当)
    // r = x * Math.pow(1 + g, n) + 0.8 * (d / 100) * (Math.pow(1 + g, n) - 1) / g;
    // nが未入力の場合や、gがゼロまたは計算不能な場合を考慮

    if (n > 0 && !isNaN(g) && g !== 0) {
        var r = x * Math.pow(1 + g, n) + 0.8 * (d / 100) * (Math.pow(1 + g, n) - 1) / g;
        var t = q * r;

        if (!isNaN(r)) {
            document.fm.ex.value = r.toFixed(4); // 小数点以下4桁まで表示
        }
        if (!isNaN(t)) {
            document.fm.pr.value = Math.round(t); // 四捨五入
        }
    } else if (n > 0 && g === 0 && !isNaN(x) && !isNaN(q)) {
        // 成長率 g が 0 の場合（等差数列の和）
        var r_g0 = x + 0.8 * (d / 100) * n;
        var t_g0 = q * r_g0;

        if (!isNaN(r_g0)) {
            document.fm.ex.value = r_g0.toFixed(4);
        }
        if (!isNaN(t_g0)) {
            document.fm.pr.value = Math.round(t_g0);
        }
    }
}

function re() {
    document.fm.reset();
    // リセット後、計算結果欄もクリア
    document.fm.ex.value = "";
    document.fm.pr.value = "";
}
</script>
</head>
<body>
<div class="container">
    <br/>
    ＜期待値スカウター＞<a href="javascript:void(0);" onclick="window.open('./kitaiti.html', 'kitaiti', 'width=500, height=600, menubar=no, toolbar=no, scrollbars=yes');">別窓</a>
    <br/>
    <br/>
    <form action="#" name="fm">
    <table border="1">
    <tr>
    <th>指標</th>
    <th>入力して下さい</th>
    </tr>
    <tr>
    <td>PER</td>
    <td><input type="text" name="per" onkeyup="x()" size="10" placeholder="PER"> 倍</td>
    </tr>
    <tr>
    <td>PBR</td>
    <td><input type="text" name="pbr" onkeyup="x()" size="10" placeholder="PBR"> 倍</td>
    </tr>
    <tr>
    <td>配当利回り</td>
    <td><input type="text" name="dy" onkeyup="x()" size="10" placeholder="配当利回り"> ％</td>
    </tr>
    <tr>
    <td>期待値</td>
    <td><input type="text" name="ex" size="10" placeholder="期待値" readonly> 倍</td>
    </tr>
    <tr>
    <td>株価</td>
    <td><input type="text" name="qo" onkeyup="x()" size="10" placeholder="株価"> 円</td>
    </tr>
    <tr>
    <td><strong>目標株価</strong></td>
    <td><input type="text" name="pr" size="10" placeholder="目標株価" readonly> 円</td>
    </tr>
    <tr>
    <td>保有年数</td>
    <td><input type="text" name="hy" onkeyup="x()" size="10" placeholder="保有年数"> 年</td>
    </tr>
    </table>
    </form>
    <p>
    <button type="button" onclick="re()">リセット</button>
    </p>
    <br/>
    <br/>
    ＜使い方＞
    <br/>
    <p>
    PER = e PBR = b 配当利回り = d と置くとき、<br/>
    期待値ｘ(割安性)を
    </p>
    <img src="x.png" alt="割安性" width="180" height="auto">
    <br/>
    <p>
    で計算しています。配当割引モデルでは成長率gは
    </p>
    <img src="doe.png" alt="RoeとDoe" width="110" height="auto">
    <br/>
    <img src="g.png" alt="サスティナブル成長率" width="100" height="auto">
    <br/>
    <p>
    になるので、<br/>
    n年後の期待値ｘは割安性×成長性＋配当と考えると
    </p>
    <img src="n.png" alt="期待値" width="300" height="auto">
    <p>
    となり、これに現在の株価を掛けると<br/>
    n年後の理論株価(トータルリターン)が計算出来ます。
    </p>
    <br/>
    <br/>
    ＜ＡＰＰ＞
    <ol>
      <li><a href="http://kabuka.s1007.xrea.com/nand/">ＮＡＮＤＧＡＭＥ</a></li>
      <li><a href="http://kabuka.s1007.xrea.com/periody/">ＰＥＲＩＯＤＹ</a></li>
      <li><a href="https://cnc-pwa.onrender.com/">ＣＮＣ-ＰＷＡ</a></li>
      <li><a href="./g1m/g1m.html">Ｇ１ＭＢＥＴＡ</a></li>
    </ol>
    <br/>
    ＜ＢＬＯＧ＞
    <ol>
      <li><a href="http://kabuka.s1007.xrea.com/kablog/">ＫＡＢＬＯＧ</a></li>
      <li><a href="https://qiita.com/Intelligence">ＱＵＩＩＴＡ</a></li>
    </ol>
    <br/>
    <br/>
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <br/>
    <br/>
    <a href="https://px.a8.net/svt/ejp?a8mat=35U70M+CGBFAQ+0K+15RK35" rel="nofollow">
    <img border="0" width="320" height="50" alt="" src="https://www21.a8.net/svt/bgt?aid=191205382753&wid=001&eno=01&mid=s00000000002007015000&mc=1"></a>
    <img border="0" width="1" height="1" src="https://www14.a8.net/0.gif?a8mat=35U70M+CGBFAQ+0K+15RK35" alt="">
    <br/>
</div>
</body>
</html>
